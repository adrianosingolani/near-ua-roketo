(this["webpackJsonpnear-ua-roketo"]=this["webpackJsonpnear-ua-roketo"]||[]).push([[0],{152:function(t,e,n){},154:function(t,e){},161:function(t,e){},217:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),c=n(127),o=n.n(c),i=(n(152),n(12)),s=n(55),l=n(29),d=n(96),u=n(18),p=n.n(u),j=n(49),b="streaming-r-v2.dcversus.testnet",h="wrap.testnet",x="streaming-ua.testnet";var O,g=function(t){switch(t){case"mainnet":return{networkId:"mainnet",nodeUrl:"https://rpc.mainnet.near.org",roketoContract:b,wrapContract:h,dappContract:x,walletUrl:"https://wallet.near.org",helperUrl:"https://helper.mainnet.near.org",explorerUrl:"https://explorer.mainnet.near.org"};case"testnet":return{networkId:"testnet",nodeUrl:"https://rpc.testnet.near.org",roketoContract:b,wrapContract:h,dappContract:x,walletUrl:"https://wallet.testnet.near.org",helperUrl:"https://helper.testnet.near.org",explorerUrl:"https://explorer.testnet.near.org"};default:throw Error('Unknown environment "'.concat(t,'".'))}}("testnet");function f(){return(f=Object(d.a)(p.a.mark((function t(){var e,n,a,r,c,o;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new j.keyStores.BrowserLocalStorageKeyStore,t.next=3,Object(j.connect)(Object(l.a)({keyStore:e},g));case 3:return n=t.sent,O=new j.WalletConnection(n),a=O.getAccountId(),r=new j.Contract(O.account(),g.roketoContract,{viewMethods:["get_stream","get_account","get_account_incoming_streams","get_account_outgoing_streams","get_stats"],changeMethods:["start_stream","pause_stream","stop_stream","withdraw"]}),c=new j.Contract(O.account(),g.wrapContract,{viewMethods:["ft_balance_of"],changeMethods:["near_deposit","ft_transfer_call","ft_transfer"]}),o=new j.Contract(O.account(),g.dappContract,{viewMethods:["getMessages"],changeMethods:["sendMessage"]}),t.abrupt("return",{walletConnection:O,accountId:a,nearEnv:g,roketoContract:r,wrapContract:c,dappContract:o});case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var m=n(278),v=n(279),w=n(281),C=n(282),y=n(274),k=n(2);function E(t){var e=t.walletConnection,n=t.accountId,r=t.wrapContract,c=e.account(),o=Object(a.useState)(0),l=Object(i.a)(o,2),d=l[0],u=l[1];return Object(a.useEffect)((function(){n&&r&&r.ft_balance_of({account_id:"".concat(n)}).then((function(t){u(t)})).catch((function(t){console.log(t)}))}),[n,r]),Object(k.jsx)(m.a,{sx:{flexGrow:1},children:Object(k.jsx)(v.a,{position:"fixed",children:Object(k.jsxs)(w.a,{children:[Object(k.jsx)(C.a,{variant:"h6",component:"div",sx:{flexGrow:1},children:"Live for Ukraine"}),c.accountId?Object(k.jsxs)(k.Fragment,{children:[Object(k.jsxs)(m.a,{style:{display:"flex",flexDirection:"column",textAlign:"right"},children:[Object(k.jsx)(C.a,{variant:"subtitle2",children:c.accountId}),Object(k.jsxs)(C.a,{variant:"subtitle2",children:[Object(s.formatNearAmount)(d,4)," wNEAR"]})]}),Object(k.jsx)(y.a,{sx:{marginLeft:2},variant:"outlined",color:"inherit",onClick:function(){return O.signOut(),void window.location.reload()},children:"Logout"})]}):Object(k.jsx)(y.a,{color:"inherit",onClick:function(){O.requestSignIn(g.dappContract)},children:"Login"})]})})})}var I=n(5),_=n(280),L=n(275),S=n(131),M=n(57),U=n.n(M),R=n(269),F={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"50%",bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:10};function A(t){t.wrapContract,t.roketoContract,t.dappContract,t.accountId;var e=Object(a.useState)(!1),n=Object(i.a)(e,2),c=n[0],o=n[1],s=Object(a.useState)(null),l=Object(i.a)(s,2),d=(l[0],l[1],r.a.useState(!0)),u=Object(i.a)(d,2),p=u[0],j=u[1],b=Object(a.useRef)();function h(){console.log("canplay"),o(!0)}function x(){console.log("stalled"),o(!1),f()}function O(){console.log("play")}function g(){console.log("pause")}function f(){console.log("ended")}return Object(a.useEffect)((function(){var t=b;return t.current.addEventListener("canplay",h),t.current.addEventListener("stalled",x),t.current.addEventListener("play",O),t.current.addEventListener("pause",g),t.current.addEventListener("ended",f),function(){t.current.removeEventListener("canplay",h),t.current.removeEventListener("stalled",x),t.current.removeEventListener("play",O),t.current.removeEventListener("pause",g),t.current.removeEventListener("ended",f)}}),[]),Object(k.jsxs)(k.Fragment,{children:[Object(k.jsx)(m.a,{sx:{flexGrow:1},children:Object(k.jsx)(L.a,{container:!0,spacing:1,children:Object(k.jsx)(L.a,{item:!0,xs:12,children:Object(k.jsx)(m.a,{sx:{display:"flex",aspectRatio:"16 / 9"},children:Object(k.jsx)(S.a,{playerRef:b,src:"https://76c240504080.us-east-1.playback.live-video.net/api/video/v1/us-east-1.395008664088.channel.wvTsdEmLB8rk.m3u8",controls:!0,muted:!0,width:"100%"})})})})}),Object(k.jsx)(R.a,{open:p,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",disableEscapeKeyDown:!0,children:Object(k.jsx)(m.a,{sx:F,children:c?Object(k.jsxs)(m.a,{sx:{display:"flex",flexDirection:"column"},children:[Object(k.jsx)(C.a,{id:"modal-modal-title",variant:"h6",children:"Streaming is live!"}),Object(k.jsx)(C.a,{id:"modal-modal-description",sx:{mt:2},paragraph:!0,children:"If you want to watch and donate, click on the button bellow and you will be asked to approve the payment."}),Object(k.jsx)(C.a,{variant:"subtitle2",paragraph:!0,children:"* You will need wNEAR for it."}),Object(k.jsx)(y.a,{variant:"contained",onClick:function(){j(!1)},children:"Watch and donate"})]}):Object(k.jsx)(k.Fragment,{children:Object(k.jsx)(C.a,{id:"modal-modal-title",variant:"h6",component:"h2",children:"Waiting for the streaming to be ready."})})})})]})}var T=n(133),B=n(134),D=n.n(B),P=n(135),N=n.n(P),G=n(271),K=n(286),W=n(14),H=n(283),J=n(272),V=n(284),q=n(276),Y=n(285),z=n(268),Q=U()(3).times(Math.pow(10,13)).toFixed();function X(t){var e=t.dappContract,n=Object(a.useRef)(null),r=Object(a.useState)([]),c=Object(i.a)(r,2),o=c[0],s=c[1],l=function(){e.getMessages().then((function(t){s(Object(W.a)(t)),n.current.scrollIntoView()})).catch((function(t){console.log(t)}))};return Object(a.useEffect)((function(){l()}),[]),Object(a.useEffect)((function(){n.current.scrollIntoView()}),[o]),Object(k.jsxs)(m.a,{sx:{width:"100%",height:"100%",bgcolor:"background.paper",borderRadius:"4px",padding:1,display:"flex",flexDirection:"column"},children:[Object(k.jsxs)(H.a,{sx:{overflow:"scroll",padding:0},children:[o.map((function(t,e){return Object(k.jsxs)(J.a,{alignItems:"flex-start",sx:{padding:"0 8px 16px"},children:[Object(k.jsx)(V.a,{children:Object(k.jsx)(q.a,{alt:t.user})}),Object(k.jsx)(Y.a,{primary:Object(k.jsx)(C.a,{variant:"subtitle2",children:t.user}),secondary:Object(k.jsx)(C.a,{variant:"body2",children:t.message})})]},e)})),Object(k.jsx)(J.a,{ref:n})]}),Object(k.jsx)(z.a,{variant:"outlined",placeholder:"Type your message",autoFocus:!0,onKeyPress:function(t){var n;"Enter"===t.key&&(n=t.target.value,e.sendMessage({message:n},Q,"0").then((function(){l()})).catch((function(t){console.log(t)})),t.target.value="")},sx:{marginTop:"auto"}})]})}var Z=[];function $(){return Object(k.jsx)(H.a,{sx:{width:"100%",bgcolor:"background.paper"},children:Z.map((function(t,e){return Object(k.jsx)(J.a,{alignItems:"flex-start",children:Object(k.jsx)(Y.a,{primary:t})},e)}))})}var tt=["children","value","index"];function et(t){var e=t.children,n=t.value,a=t.index,r=Object(T.a)(t,tt);return Object(k.jsx)(m.a,Object(l.a)(Object(l.a)({role:"tabpanel",hidden:n!==a,id:"simple-tabpanel-".concat(a),"aria-labelledby":"simple-tab-".concat(a)},r),{},{children:n===a&&Object(k.jsx)(m.a,{sx:{paddingTop:2,height:"100%"},children:e})}))}function nt(t){return{id:"simple-tab-".concat(t),"aria-controls":"simple-tabpanel-".concat(t)}}function at(t){var e=t.dappContract,n=Object(a.useState)(1),r=Object(i.a)(n,2),c=r[0],o=r[1];return Object(k.jsxs)(m.a,{sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column"},children:[Object(k.jsx)(m.a,{sx:{borderBottom:1,borderColor:"divider"},children:Object(k.jsxs)(G.a,{value:c,onChange:function(t,e){o(e)},"aria-label":"Chat tab",children:[Object(k.jsx)(K.a,Object(l.a)(Object(l.a)({sx:{minHeight:"fit-content"},icon:Object(k.jsx)(D.a,{}),iconPosition:"start",label:"Users"},nt(0)),{},{wrapped:!0,disableRipple:!0})),Object(k.jsx)(K.a,Object(l.a)(Object(l.a)({sx:{minHeight:"fit-content"},icon:Object(k.jsx)(N.a,{}),iconPosition:"start",label:"Chat"},nt(1)),{},{wrapped:!0,disableRipple:!0}))]})}),Object(k.jsxs)(m.a,{sx:{height:"100%",overflow:"hidden"},children:[Object(k.jsx)(et,{value:c,index:0,children:Object(k.jsx)($,{})}),Object(k.jsx)(et,{value:c,index:1,sx:{height:"100%"},children:Object(k.jsx)(X,{dappContract:e})})]})]})}var rt=Object(I.a)(_.a)((function(t){var e=t.theme;return Object(l.a)(Object(l.a)({backgroundColor:"dark"===e.palette.mode?"#1A2027":"#fff"},e.typography.body2),{},{padding:e.spacing(1),textAlign:"center",color:e.palette.text.secondary,border:"1px solid #EEE"})}));var ct=function(t){var e=t.wrapContract,n=t.dappContract,a=t.roketoContract,r=t.accountId;return Object(k.jsx)(m.a,{sx:{height:"100%"},children:Object(k.jsxs)(L.a,{container:!0,spacing:2,sx:{height:"100%",padding:"16px 16px 0"},children:[Object(k.jsx)(L.a,{item:!0,xs:8,children:Object(k.jsx)(rt,{children:Object(k.jsx)(A,{})})}),Object(k.jsx)(L.a,{item:!0,xs:4,sx:{height:"100%"},children:Object(k.jsx)(rt,{sx:{height:"100%"},children:Object(k.jsx)(at,{dappContract:n,roketoContract:a,accountId:r,wrapContract:e})})})]})})};var ot=function(t){var e=t.walletConnection,n=t.accountId,a=(t.nearEnv,t.roketoContract),r=t.wrapContract,c=t.dappContract;return Object(k.jsxs)(m.a,{className:"App",sx:{height:"100%"},children:[Object(k.jsx)(E,{walletConnection:e,accountId:n,wrapContract:r}),Object(k.jsx)(m.a,{style:{paddingTop:"4em",height:"100%"},children:Object(k.jsx)(ct,{walletConnection:e,dappContract:c,roketoContract:a,accountId:n,wrapContract:r})})]})},it=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,288)).then((function(e){var n=e.getCLS,a=e.getFID,r=e.getFCP,c=e.getLCP,o=e.getTTFB;n(t),a(t),r(t),c(t),o(t)}))},st=n(267),lt=n(136),dt=n(277),ut=Object(lt.a)({palette:{mode:"light"},components:{MuiButton:{styleOverrides:{root:{margin:"8px"}}}}});window.nearInitPromise=function(){return f.apply(this,arguments)}().then((function(t){var e=t.walletConnection,n=t.accountId,a=t.nearEnv,c=t.roketoContract,i=t.wrapContract,s=t.dappContract;o.a.createRoot(document.getElementById("root")).render(Object(k.jsx)(r.a.StrictMode,{children:Object(k.jsxs)(dt.a,{theme:ut,children:[Object(k.jsx)(st.a,{}),Object(k.jsx)(ot,{walletConnection:e,accountId:n,nearEnv:a,roketoContract:c,wrapContract:i,dappContract:s})]})}))})).catch(console.error),it()}},[[217,1,2]]]);
//# sourceMappingURL=main.f4d46891.chunk.js.map